if (self.CavalryLogger) { CavalryLogger.start_js(["80sUR"]); }

__d("PixelRatioConst",[],(function(a,b,c,d,e,f){e.exports={cookieName:"dpr"}}),null);
__d("legacy:onload-action",["PageHooks"],(function(a,b,c,d,e,f){a._domreadyHook=b("PageHooks")._domreadyHook,a._onloadHook=b("PageHooks")._onloadHook,a.runHook=b("PageHooks").runHook,a.runHooks=b("PageHooks").runHooks,a.keep_window_set_as_loaded=b("PageHooks").keepWindowSetAsLoaded}),3);
__d("AsyncRequestPathTraversalTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1={}}var c=a.prototype;c.log=function(){b("GeneratedLoggerUtils").log("logger:AsyncRequestPathTraversalLoggerConfig",this.$1,b("Banzai").BASIC)};c.logVital=function(){b("GeneratedLoggerUtils").log("logger:AsyncRequestPathTraversalLoggerConfig",this.$1,b("Banzai").VITAL)};c.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:AsyncRequestPathTraversalLoggerConfig",this.$1,{signal:!0})};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setOffendingURI=function(a){this.$1.offending_uri=a;return this};c.setTime=function(a){this.$1.time=a;return this};c.setWeight=function(a){this.$1.weight=a;return this};return a}();c={offending_uri:!0,time:!0,weight:!0};e.exports=a}),null);
__d("WaterfallMessageLifetimeTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1={}}var c=a.prototype;c.log=function(){b("GeneratedLoggerUtils").log("logger:WaterfallMessageLifetimeLoggerConfig",this.$1,b("Banzai").BASIC)};c.logVital=function(){b("GeneratedLoggerUtils").log("logger:WaterfallMessageLifetimeLoggerConfig",this.$1,b("Banzai").VITAL)};c.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:WaterfallMessageLifetimeLoggerConfig",this.$1,{signal:!0})};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setAttemptID=function(a){this.$1.attempt_id=a;return this};c.setDestService=function(a){this.$1.dest_service=a;return this};c.setDeviceID=function(a){this.$1.device_id=a;return this};c.setEventType=function(a){this.$1.event_type=a;return this};c.setIsBatch=function(a){this.$1.is_batch=a;return this};c.setIsGroup=function(a){this.$1.is_group=a;return this};c.setMessageID=function(a){this.$1.message_id=a;return this};c.setOfflineThreadingID=function(a){this.$1.offline_threading_id=a;return this};c.setPageID=function(a){this.$1.page_id=a;return this};c.setPushNotifID=function(a){this.$1.push_notif_id=a;return this};c.setReceiptID=function(a){this.$1.receipt_id=a;return this};c.setSenderID=function(a){this.$1.sender_id=a;return this};c.setServiceName=function(a){this.$1.service_name=a;return this};c.setSrcService=function(a){this.$1.src_service=a;return this};c.setThreadID=function(a){this.$1.thread_id=a;return this};c.setTime=function(a){this.$1.time=a;return this};c.setTimeStamp=function(a){this.$1.time_stamp=a;return this};c.setTopic=function(a){this.$1.topic=a;return this};c.setWeight=function(a){this.$1.weight=a;return this};c.updateExtraData=function(a){a=b("nullthrows")(b("GeneratedLoggerUtils").serializeMap(a));b("GeneratedLoggerUtils").checkExtraDataFieldNames(a,g);this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.addToExtraData=function(a,b){var c={};c[a]=b;return this.updateExtraData(c)};return a}();var g={attempt_id:!0,dest_service:!0,device_id:!0,event_type:!0,is_batch:!0,is_group:!0,message_id:!0,offline_threading_id:!0,page_id:!0,push_notif_id:!0,receipt_id:!0,sender_id:!0,service_name:!0,src_service:!0,thread_id:!0,time:!0,time_stamp:!0,topic:!0,weight:!0};e.exports=a}),null);
__d("MercuryRealTimeEnvironmentDropDown",["Arbiter","Bootloader","FBLogger","MessengerMQTTGating"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={token:null,init:function(){g.token=b("Arbiter").subscribe("mqtt-websocket-connection-died",g.handleConnectionDied)},handleConnectionDied:function(){if(!g.token||!b("MessengerMQTTGating").isEnabled())return;g.token&&(b("Arbiter").unsubscribe(g.token),g.token=null);g.dropDownToChannel()},dropDownToChannel:function(){b("MessengerMQTTGating").turnOff(),b("Bootloader").loadModules(["ChannelManager"],function(a){a.startChannelManager(),b("Arbiter").inform("messenger-mqtt-drop-down-to-channel")},"MercuryRealTimeEnvironmentDropDown"),b("FBLogger")("messenger_web_mqtt").warn("drop down to channel")}};e.exports=g}),null);
__d("MercurySyncResnapshot",["Promise","Bootloader","MercurySingletonProvider"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){this.$2=a}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};var c=a.prototype;c.resnapshot=function(){var a=this;this.$1||(this.$1=new(b("Promise"))(function(c,d){b("Bootloader").loadModules(["MercurySyncDeltaHandler"],function(b){b.getForFBID(a.$2).emergencyDFF(function(b){c(b),a.$1=null},function(){d(),a.$1=null})},"MercurySyncResnapshot")}));return this.$1};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("IrisSubscribeChecker",["MqttLogger","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1=b("MqttLogger").getInstance(),this.$2=null,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=!0}var c=a.prototype;c.start=function(){this.$6=!0};c.stop=function(){this.$6=!1,this.$7()};c.onConnectAttempt=function(){};c.onConnectFailure=function(){};c.onConnected=function(){var a=this;this.$7();this.$3=!1;this.$4=!1;this.$5=!1;this.$6&&(this.$2=b("setTimeoutAcrossTransitions")(function(){a.$8()},8e3))};c.onConnectSuccess=function(){};c.onConnectionLost=function(){this.$7()};c.onSubscribe=function(a){a==="/t_ms"&&(this.$3=!0)};c.onUnsubscribe=function(a){};c.onPublish=function(a){(a==="/messenger_sync_get_diffs"||a==="/messenger_sync_create_queue")&&(this.$4=!0,this.$3&&(this.$5=!0,this.$7()))};c.onMessage=function(a){};c.onWSFatal=function(){};c.$7=function(){this.$2!==null&&(b("clearTimeout")(this.$2),this.$2=null)};c.$8=function(){this.$3===!1&&(this.$1.bumpCounter("no_iris_topic_subscribe"),this.$1.debugTrace("irisSubscribeChecker","iris topic not subscribed")),this.$4===!1&&(this.$1.bumpCounter("no_iris_session"),this.$1.debugTrace("irisSubscribeChecker","iris session not subscribed")),this.$3===!0&&this.$4===!0&&this.$5===!1&&(this.$1.bumpCounter("session_before_topic_subscribe"),this.$1.debugTrace("irisSubscribeChecker","iris session subscribed before topic subscribe"))};return a}();e.exports=a}),null);
__d("MqttWaterfallLogger",["WaterfallMessageLifetimeTypedLogger","gkx"],(function(a,b,c,d,e,f){"use strict";a={logNewMessageToWaterfall:function(a){var c=a.senderID,d=a.receiptID,e=a.messageID,f=a.offlineThreadingID,g=a.threadID,h=a.irisSeqId;a=a.isGroup;if(!b("gkx")("832242"))return;new(b("WaterfallMessageLifetimeTypedLogger"))().setEventType("message_receive_ws").setSrcService("mqtt").setDestService("webclient").setSenderID(c).setReceiptID(d).setMessageID(e).setOfflineThreadingID(f).setThreadID(g).setIsGroup(a?1:0).addToExtraData("sync_seq_id",h).log()}};e.exports=a}),null);
__d("exponentialBackoff",["Random","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c){__p&&__p();c===void 0&&(c=null);var d=null,e=0;function f(){__p&&__p();for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];var i=function(){a.apply(c,g)};if(e===0)i();else if(d===null){var j=Math.pow(2,Math.min(e,6))*(1e3+b("Random").random()*200);d=b("setTimeoutAcrossTransitions")(function(){i(),d=null},j)}e++}f.reset=function(){e=0,d!=null&&(b("clearTimeout")(d),d=null)};f.isPending=function(){return d!=null};return f}e.exports=a}),null);
__d("MessageEventStream",["Int64","IrisSubscribeChecker","MercurySingletonProvider","MqttLogger","MqttWaterfallLogger","exponentialBackoff","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();a.getForFBID=function(a){return g.getForFBID(a)};function a(a){__p&&__p();var c=this;this.$12=function(){__p&&__p();var a;if(c.$4){if(!c.$3){c.$5.bumpCounter("subscribe_to_iris_no_seq_id");return}a=c.$17()}else a=c.$18();c.$5.debugTrace("Sending request",JSON.stringify({topic:a.topic,payload:a.payload}));c.$9.publish(a.topic,a.payload,{qos:1,skipBuffer:!0})};this.$1=a;this.$2=[];this.$5=b("MqttLogger").getInstance();this.$11=new(b("exponentialBackoff"))(this.$12,this);this.$10=new(b("IrisSubscribeChecker"))()}var c=a.prototype;c.getPublishMessages=function(){return this.$13()};c.init=function(a,c,d,e){__p&&__p();var f=this;if(!c&&!e)return this;this.$9=a;this.$9.addHook(this.$10);this.$8=!0;this.$3=c?b("Int64").fromString(c):null;this.$6=d;this.$7=e;this.$4=null;this.$9.subscribe("/t_ms",function(a){return f.$14(a)});this.$9.subscribe("/thread_typing",function(a){f.$15(a)});this.$9.subscribe("/orca_typing_notifications",function(a){f.$15(a)});this.$9.subscribe("/notify_disconnect",function(a){return f.$16(a)});this.connectToIris();return this};c.connectToIris=function(a){a===void 0&&(a=null),a!==null&&(this.$3=b("Int64").fromString(a)),this.$8=!0,this.$10.start(),this.$9.registerExtraConnectPayloadProvider(this)};c.$13=function(){__p&&__p();var a;if(this.$4){if(!this.$3){this.$5.bumpCounter("connect_payload_iris_no_seq_id");return[]}a=this.$17()}else a=this.$18();this.$5.debugTrace("Sending request with MQTT Connect",JSON.stringify({topic:a.topic,payload:a.payload}));return[a]};c.$19=function(a){var b=null;try{b=JSON.parse(a)}catch(a){this.$5.logError(a,"Unable to process data")}return b};c.$15=function(a){var b=this.$19(a);if(b==null){this.$5.logWarn("_processTypingData","Unable to process typing data");return}this.$2.forEach(function(a){typeof a.onTypingReceived==="function"&&a.onTypingReceived(b)})};c.addDeltaStreamListener=function(a){this.$2.push(a)};c.$16=function(a){this.$5.logWarn("_handleNotifyDisconnect","Disconnecting reason: "+a),this.$5.bumpCounter("notify_disconnect_"+a),a==="IRIS_CURSOR_LIMIT"&&this.$20(a)};c.$20=function(a){this.$5.bumpCounter(a+"_request"),this.$4=null,this.$8=!1,this.$10.stop(),this.$9.unregisterExtraConnectPayloadProvider(this),this.$2.forEach(function(b){return b.onStreamDisconnect(a)})};c.$14=function(a){__p&&__p();a=this.$19(a);if(a==null){this.$5.logWarn("_processDeltas","Unable to process delta");return}var b={syncToken:a.syncToken,entityId:a.queueEntityId,errorCode:a.errorCode,firstSeqId:a.firstDeltaSeqId,lastSeqId:a.lastIssuedSeqId};this.$5.debugTrace("Sync data received",JSON.stringify(b));b=this.$1;if(a.syncToken){this.$21(a);return}else if(a.queueEntityId!=b){this.$5.bumpCounter("delta_for_other_fbid");return}else a.errorCode?this.$22(a.errorCode):this.$23(a)};c.$22=function(a){this.$5.bumpCounter("iris_queue_error."+a),this.$5.logWarn("_handleIrisError","Recevied an error code from sync protocol "+a),a==="ERROR_QUEUE_TEMPORARY_NOT_AVAILABLE"?this.$11():this.$20(a)};c.$21=function(a){var c=this;this.$4=a.syncToken;this.$3=b("Int64").fromString(a.firstDeltaSeqId.toString());this.$5.debugTrace("Sync token received",JSON.stringify({token:this.$4}));this.$9.subscribeChannelEvents({onMQTTStateChanged:function(a,b){a==="Connected"&&c.$11.reset()}})};c.$23=function(a){var c=a.deltas,d=this.$3;if(c&&d){var e=b("Int64").fromString(a.firstDeltaSeqId.toString());a=b("Int64").fromString(a.lastIssuedSeqId.toString());e.equals(d.add(b("Int64").ONE))?this.$24(e,a,c):e.compare(d)<0?(this.$5.bumpCounter("delta_batch_in_middle"),a.compare(d)>0&&this.$24(d.add(b("Int64").ONE),a,c)):(this.$5.bumpCounter("missing_deltas_get_diffs"),this.$12())}else this.$5.bumpCounter("process_deltas_invalid_state")};c.$24=function(a,c,d){__p&&__p();a=a;for(var e=0;e<d.length;e++){var f=d[e],g=f["class"]||"Missing";try{g=="NewMessage"&&b("MqttWaterfallLogger").logNewMessageToWaterfall({senderID:f.messageMetadata.actorFbId,receiptID:this.$1,messageID:f.messageMetadata.messageId,offlineThreadingID:f.messageMetadata.offlineThreadingId,threadID:f.messageMetadata.threadKey.threadFbId!=null?f.messageMetadata.threadKey.threadFbId:"",irisSeqId:f.irisSeqId?f.irisSeqId:a.toString(),isGroup:f.messageMetadata.threadKey.threadFbId!=null})}catch(a){this.$5.logError(a,"Unable to log to waterfall")}var h={seqId:a.toString(),type:g,status:""},i=1;if(g!="Missing")try{i=this.$25(f,g,a,h)}catch(a){h.status="err:"+a.message}else h.status="no type",this.$5.bumpCounter("missing_delta_type");this.$5.debugTrace("onDeltaReceived",JSON.stringify(h));a=a.add(b("Int64").fromInt(i))}this.$3=c};c.$25=function(a,c,d,e){__p&&__p();var f=1,g="";c==="NoOp"&&(f=a.numNoOps||f,g+="n:"+f);a.irisSeqId||(a.irisSeqId=d.toString(),g+="missing seq id");var h=b("Int64").fromString(a.irisSeqId.toString())||d;h.equals(d)?g+=" seqId match":(g+=" seqId mismatch",this.$5.bumpCounter("seq_id_running_id_mismatch"));var i={type:c,payload:a};this.$2.forEach(function(a){return a.onDeltaReceived(i)});e.status=g;return f};c.$18=function(){var a={sync_api_version:10,max_deltas_able_to_process:1e3,delta_batch_size:500,encoding:"JSON",entity_fbid:this.$1,initial_titan_sequence_id:this.$3&&this.$3.toString(),device_params:this.$6,queue_position:this.$7};return{topic:"/messenger_sync_create_queue",payload:JSON.stringify(a),qos:1}};c.$17=function(){var a={sync_token:this.$4,sync_api_version:10,max_deltas_able_to_process:1e3,delta_batch_size:500,encoding:"JSON",entity_fbid:this.$1,last_seq_id:this.$3&&this.$3.toString()};return{topic:"/messenger_sync_get_diffs",payload:JSON.stringify(a),qos:1}};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MessengerMQTTPayloadPreprocessor",[],(function(a,b,c,d,e,f){"use strict";a={process:function(a,b,c){var d=parseInt(c.irisSeqId.toString(),10);return{seqID:d,obj:{queue:a,iseq:d,delta:c,seqID:d,type:b}}}};e.exports=a}),null);
__d("MessengerMQTTPresence",["FBMqttChannel","PresenceStatus"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="/orca_presence",h="/send_additional_contacts",i=!1;a={subscribe:function(){if(i)return;i=!0;b("FBMqttChannel").subscribe(g,function(a){a=JSON.parse(a);a&&a.list&&b("PresenceStatus").setMultiFromMQTT(a.list)})},unsubscribe:function(){i=!1,b("FBMqttChannel").unsubscribe(g)},sendAdditionalBuddyRequest:function(a){b("FBMqttChannel").publish(h,JSON.stringify({additional_contacts:[a]}))}};e.exports=a}),null);
__d("MessengerMQTTPresenceActivity",["Event","MercuryConfig","MessengerMQTTPresence","UserActivity"],(function(a,b,c,d,e,f){__p&&__p();var g=b("MercuryConfig").idle_limit||18e5;a=b("MercuryConfig").idle_poll_interval||3e5;var h=Date.now(),i=!0;function j(){h=Date.now(),b("MessengerMQTTPresence").subscribe()}c={init:function(){b("Event").listen(window,"focus",function(){i=!0,j()}),b("Event").listen(window,"blur",function(){i=!1}),b("UserActivity").subscribe(function(){j()})}};window.setInterval(function(){!i&&Date.now()-h>g&&b("MessengerMQTTPresence").unsubscribe()},a);e.exports=c}),null);
__d("MessengerMQTTTypingDataPreProcessor",[],(function(a,b,c,d,e,f){"use strict";a={process:function(a,b){var c=b.thread;a=c==null?{from:b.sender_fbid,st:b.state,to:a,type:"typ"}:{from:b.sender_fbid,st:b.state,thread:c,thread_fbid:c,type:"ttyp"};return{obj:a}}};e.exports=a}),null);
__d("MessengerMQTTConnection",["Arbiter","CurrentUser","FBMqttChannel","MercuryRealTimeEnvironmentDropDown","MercurySingletonProvider","MercurySyncResnapshot","MessageEventStream","MessengerMQTTConnectionEvents","MessengerMQTTPayloadPreprocessor","MessengerMQTTPresence","MessengerMQTTTypingDataPreProcessor","MqttLogger","gkx","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MessengerMQTTConnectionEvents").DELTA_EVENT,h=b("MessengerMQTTConnectionEvents").STREAM_CONNECT,i=b("MessengerMQTTConnectionEvents").STREAM_DISCONNECT,j=b("MessengerMQTTConnectionEvents").STREAM_CONNECTING;b("MessengerMQTTConnectionEvents").STATE_CONNECTED;var k=b("MessengerMQTTConnectionEvents").STATE_CONNECTING,l=b("MessengerMQTTConnectionEvents").STATE_DISCONNECTED,m=b("MessengerMQTTConnectionEvents").TYP;a=function(){__p&&__p();a.getForFBID=function(a){return n.getForFBID(a)};a.get=function(){return n.get()};function a(a){this.$1=a,this.$2=b("MqttLogger").getInstance()}a.setUp=function(c){__p&&__p();var e=c.fbid,f=c.irisSeqID;c.appID;c.endpoint;b("MercuryRealTimeEnvironmentDropDown").init();if(!e||!f)return;c=b("MqttLogger").getInstance();if(!b("CurrentUser").isLoggedInNow()){c.debugTrace("run","User not logged in");c.bumpCounter("user_not_loggged_in");return}var g=a.getForFBID(e);a.addDeltaStream({fbid:e,irisSeqID:f});g.$3(b("FBMqttChannel").getConnectionState(),b("FBMqttChannel").getLongPollingStatus());b("FBMqttChannel").subscribeChannelEvents({onMQTTStateChanged:function(a,b){g.$3(a,b)},onJSError:function(a){g.$4("mqtt_js_error")}});(b("gkx")("845715")||b("gkx")("845716"))&&b("MessengerMQTTPresence").subscribe();b("gkx")("845716")&&d(["MessengerMQTTPresenceActivity"],function(a){a.init()})};a.addDeltaStream=function(c){var d=c.fbid;c=c.irisSeqID;var e=a.getForFBID(d),f=null;b("gkx")("687751")&&(f={accept_pending_deltas:!0});b("MessageEventStream").getForFBID(d).init(b("FBMqttChannel"),c,f).addDeltaStreamListener(e)};var c=a.prototype;c.onDeltaReceived=function(a){var c=a.type;a=a.payload;c=b("MessengerMQTTPayloadPreprocessor").process(this.$1,c,a);b("Arbiter").inform(g,c)};c.onStreamDisconnect=function(a){__p&&__p();var c=this;if(a==="IRIS_CURSOR_LIMIT"){b("gkx")("678680")&&this.$2.bumpCounter("dropping_down_to_chatproxy.employee_iris_cursor_limit");this.$4("iris_cursor_limit");this.$2.logMiscellaneousError({errorMessage:"iris_cursor_limit"});return}if(a==="ERROR_QUEUE_LOST"||a==="ERROR_QUEUE_NOT_FOUND"||a==="ERROR_QUEUE_EXCEEDS_MAX_DELTAS"||a==="ERROR_QUEUE_UNDERFLOW"||a==="ERROR_QUEUE_OVERFLOW"){b("promiseDone")(b("MercurySyncResnapshot").getForFBID(this.$1).resnapshot(),function(a){b("MessageEventStream").getForFBID(c.$1).connectToIris(a.toString())},function(){c.$4("resnapshot_failed")});return}this.$2.bumpCounter("unhandled_iris_error."+a);b("Arbiter").inform(i,a)};c.onTypingReceived=function(a){a=b("MessengerMQTTTypingDataPreProcessor").process(this.$1,a);b("Arbiter").inform(m,a)};c.$3=function(a,c){if(a=="Connected"||c=="LPActive"){b("Arbiter").inform(h);return}switch(a){case k:b("Arbiter").inform(j);break;case l:b("Arbiter").inform(i);break}};c.$4=function(a){b("Arbiter").inform("mqtt-websocket-connection-died"),this.$2.bumpCounter("dropping_down_to_chatproxy."+a),this.$2.logWarn("connection_died","Dropping down to ChatProxy")};return a}();var n=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("WebPixelRatioDetector",["Cookie","DOMEventListener","PixelRatioConst","Run"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("PixelRatioConst").cookieName,h=!1,i=!1,j=!1;function k(){return window.devicePixelRatio||1}function l(){b("Cookie").set(g,String(k()))}function m(){b("Cookie").clear(g)}function n(){if(i)return;i=!0;j&&m();k()!==1?l():m()}a={startDetecting:function(a){a&&(j=!0);if(h)return;h=!0;"onpagehide"in window&&b("DOMEventListener").add(window,"pagehide",n);b("Run").onBeforeUnload(n,!1)}};e.exports=a}),null);
__d("VisualCompletionGating",["requireCond","cr:729414"],(function(a,b,c,d,e,f){"use strict";e.exports=b("cr:729414")}),null);
__d("MqttLongPollingHookCollection",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1=new Set()}var b=a.prototype;b.addHook=function(a){this.$1.add(a)};b.removeHook=function(a){this.$1["delete"](a)};b.onPollRequestSent=function(){this.$1.forEach(function(a){a.onPollRequestSent()})};b.onPollRequestSuccess=function(){this.$1.forEach(function(a){a.onPollRequestSuccess()})};b.onPollResponse=function(a){this.$1.forEach(function(b){b.onPollResponse(a)})};b.onPollRequestFailed=function(a){this.$1.forEach(function(b){b.onPollRequestFailed(a)})};return a}();e.exports=a}),null);
__d("MqttLongPollingClient",["MqttLogger","XHRRequest","getCrossOriginTransport","paho-mqtt"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("paho-mqtt").Decoder,h=60*1e3;a=function(){__p&&__p();function a(a,c,d,e){this.$2=a,this.$3=b("MqttLogger").getInstance(),this.$1="Ready",this.$4=c,this.$5=d,this.$6=e,this.$7=null}var c=a.prototype;c.run=function(){this.$8(this.$4)};c.abort=function(){this.$7!=null&&this.$7.abort("Disconnected")};c.$9=function(a,b){if(this.$1===a)return;this.$1=a;a=="Error"&&b!=null&&this.$6(b)};c.$10=function(a){__p&&__p();if(this.$1!="RequestSend")return;if(!a){this.$11("EmptyResponse",null);return}this.$9("ResponseReceived");a=g.decode(a);a=a.filter(function(a){return a.payloadMessage}).map(function(a){return a.payloadMessage});this.$5(a)};c.$11=function(a,b){b=b!=null?b.message:"null";this.$3.debugTrace("LongPollingClient Error","Poll failed with error:"+a+", errorMsg:"+b);this.$3.bumpCounter(""+a);this.$9("Error",a)};c.$8=function(a){__p&&__p();var c=this;if(this.$1!="Ready"||this.$7)return;this.$7=new(b("XHRRequest"))(this.$2).setResponseType("arraybuffer").setRawData(a).setTransportBuilder(b("getCrossOriginTransport").withCredentials).setResponseHandler(function(a){return c.$10(a)}).setNetworkFailureHandler(function(a){c.$11("Network",a)}).setErrorHandler(function(a){c.$11("Error",a)}).setAbortHandler(function(a){c.$11("Abort",null)}).setTimeoutHandler(function(){c.$11("Timeout",null)}).setTimeout(h).send();this.$9("RequestSend")};return a}();e.exports=a}),null);
__d("MqttLongPollingRunner",["MqttLogger","MqttLongPollingClient","MqttLongPollingHookCollection","MqttTypes","Random","WebSocketAvailability","clearTimeout","exponentialBackoff","gkx","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MqttTypes").MqttChannelError,h=b("WebSocketAvailability").getWSAvailability,i=b("WebSocketAvailability").WSAvailabilities,j=4,k="mqtt_should_longpoll";a=function(){__p&&__p();function a(a,c,d,e,f,i,j,k){__p&&__p();var l=this;this.$20=function(){__p&&__p();try{if(!l.$25())return;var a=l.$9(),c=l.$10(),d=a.filter(function(a){return l.MqttLongPollingSupportedTopics.has(a)});a=c.filter(function(a){return l.MqttLongPollingSupportedTopics.has(a.topic)});var e=a.map(function(a){return a.topic}),f=Math.floor(b("Random").random()*Number.MAX_SAFE_INTEGER);c=l.$7.gen(f,d,a);var h=Date.now();if(d.length==0&&a.length==0){l.$5.debugTrace("LongPollingRunner","Poll skipped, nothing to do");b("setTimeoutAcrossTransitions")(function(){l.$20()},1e3);return}l.$14=new(b("MqttLongPollingClient"))(l.$6,c,function(a){return l.$26(h,f,d,e,a)},function(a){return l.$27(a)});l.$14.run();l.$18.onPollRequestSent();c=d.join(",");a=a.map(function(a){return a.topic}).join(",");l.$5.debugTrace("LongPollingRunner","Making a poll request to "+l.$6+". SubscribedTopics:"+c+". Publishes:"+a)}catch(a){l.$5.bumpCounter("lp_js_error"),a&&l.$5.logErrorWarn(a,"js error lp"),l.$11(new g(!1,"js error lp",a))}};this.$6=a;this.$7=c;this.$1=!1;this.$2=0;this.$3=d;this.$4=h();this.$5=b("MqttLogger").getInstance();this.$8=e;this.$9=f;this.$10=i;this.$11=j;this.$12=k;this.$13=!1;this.$14=null;this.$15="LPInactive";this.$16=0;this.$18=new(b("MqttLongPollingHookCollection"))();this.$17=new(b("exponentialBackoff"))(this.$20,this);this.MqttLongPollingSupportedTopics=new Set(["/t_ms","/messenger_sync_get_diffs","/messenger_sync_create_queue"]);b("gkx")("899244")&&(this.MqttLongPollingSupportedTopics.add("/webrtc"),this.MqttLongPollingSupportedTopics.add("/t_rtc_multi"));this.$19=!1}var c=a.prototype;c.addHook=function(a){this.$18.addHook(a)};c.start=function(){this.$20()};c.onConnectAttempt=function(){};c.onConnectFailure=function(){this.$2++,this.$20()};c.onConnected=function(){};c.onConnectSuccess=function(){this.$1=!0};c.onConnectionLost=function(){};c.onSubscribe=function(a){};c.onUnsubscribe=function(a){};c.onPublish=function(a){};c.onMessage=function(a){};c.onWSFatal=function(){this.$3=!0,this.$20()};c.getStatus=function(){return this.$15};c.$21=function(a){a!=this.$15&&(this.$5.debugTrace("LongPollingRunner","status changed to "+a+" from "+this.$15),this.$15=a,this.$12(this.$15))};c.$22=function(){this.$16=0};c.$23=function(){this.$16++,this.$16>=j&&this.$21("LPError")};c.$24=function(){__p&&__p();var a=b("gkx")("865724"),c=b("gkx")("865725");this.$5.debugTrace("LongPollingRunner","_shouldPoll? forcedPoll:"+String(a)+" enabled:"+String(c)+" wsAvailability:"+String(this.$4)+" hasSuccess:"+String(this.$1)+" failureCount:"+this.$2+" wsFatal:"+String(this.$3));if(a)return!0;if(this.$4===i.NotAvailable){this.$5.bumpCounter(k+".na");return c}if(this.$3){this.$5.bumpCounter(k+".fatal");return c}if(this.$1)return!1;if(this.$4===i.LikelyNotAvailable&&this.$2>=2){this.$5.bumpCounter(k+".lna");return c}if(this.$2>=4){this.$5.bumpCounter(k+".failure");return c}return!1};c.$25=function(){if(this.$14!=null)return!1;var a=this.$24();!this.$13&&a&&(this.$5.bumpCounter("polling_kickin"),this.$13=!0,this.$21("LPActive"),this.$22());this.$13&&!a&&(this.$5.bumpCounter("polling_stopped"),this.$13=!1,this.$21("LPInactive"),this.$22());return a};c.$26=function(a,b,c,d,e){__p&&__p();var f=e.map(function(a){return a.destinationName}).join(",");this.$5.debugTrace("LongPollingRunner","Poll request success, message received:"+f);this.$18.onPollRequestSuccess();for(var f=e,e=Array.isArray(f),g=0,f=e?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(e){if(g>=f.length)break;h=f[g++]}else{g=f.next();if(g.done)break;h=g.value}h=h;this.$18.onPollResponse(h.destinationName);this.$8(h.destinationName,h.payloadString)}this.$14=null;this.$17.reset();this.$21("LPActive");this.$22();this.$20();this.$19||(this.$19=!0,this.$5.logSimplePull({sessionID:b,status:!0,duration:Date.now()-a,hostname:this.$6,subscribedTopics:c,publishes:d}))};c.$27=function(a){this.$18.onPollRequestFailed(a),this.$14=null,this.$17(),this.$23()};return a}();e.exports=a}),null);